{% extends "layouts/nav_app_honey.html" %}

{% block main_link_css %}
    <!-- <link rel="stylesheet" href="{{ url_for('static', filename='home.css') }}"> -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/ui/sonido.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/ui/input_radio_square.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/ui/select_div.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/ui/input_simple.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/styles_restaurant/view_orders.css') }}">
{% endblock %}

{% block main_body %}
    <section class="container-section-main">
        <div class="container-title-list-order-main">
            <h1>Ã“rdenes por aceptar</h1>
            <div class="container-sonido-ui-activate">
                <label class="container">
                <input type="checkbox" id="checked-new-order-sound">
                <svg viewBox="0 0 576 512" height="1.3rem" xmlns="http://www.w3.org/2000/svg" class="mute"><path fill="#c62020" d="M301.1 34.8C312.6 40 320 51.4 320 64V448c0 12.6-7.4 24-18.9 29.2s-25 3.1-34.4-5.3L131.8 352H64c-35.3 0-64-28.7-64-64V224c0-35.3 28.7-64 64-64h67.8L266.7 40.1c9.4-8.4 22.9-10.4 34.4-5.3zM425 167l55 55 55-55c9.4-9.4 24.6-9.4 33.9 0s9.4 24.6 0 33.9l-55 55 55 55c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0l-55-55-55 55c-9.4 9.4-24.6 9.4-33.9 0s-9.4-24.6 0-33.9l55-55-55-55c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0z"></path></svg>
                <svg viewBox="0 0 448 512" height="1.3rem" xmlns="http://www.w3.org/2000/svg" class="voice"><path fill="#3333e9" d="M301.1 34.8C312.6 40 320 51.4 320 64V448c0 12.6-7.4 24-18.9 29.2s-25 3.1-34.4-5.3L131.8 352H64c-35.3 0-64-28.7-64-64V224c0-35.3 28.7-64 64-64h67.8L266.7 40.1c9.4-8.4 22.9-10.4 34.4-5.3zM412.6 181.5C434.1 199.1 448 225.9 448 256s-13.9 56.9-35.4 74.5c-10.3 8.4-25.4 6.8-33.8-3.5s-6.8-25.4 3.5-33.8C393.1 284.4 400 271 400 256s-6.9-28.4-17.7-37.3c-10.3-8.4-11.8-23.5-3.5-33.8s23.5-11.8 33.8-3.5z"></path></svg></label>
            </div>
        </div>
        <div class="container-all-of-folder-block__one" id="container-table-div-scroll-view-perfect">
            {% if orderData %}
                {% for order in orderData %}
                    <div class="container-all-of-folder-block__block-main" id="container-{{ order.id }}">
                        <div class="container-profile-user-context">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="#8750e8" d="M12 2a5 5 0 1 0 5 5a5 5 0 0 0-5-5m0 8a3 3 0 1 1 3-3a3 3 0 0 1-3 3m9 11v-1a7 7 0 0 0-7-7h-4a7 7 0 0 0-7 7v1h2v-1a5 5 0 0 1 5-5h4a5 5 0 0 1 5 5v1z"/></svg>
                            <span>{{ order.user_context_name }}</span>
                        </div>
                        <div class="container-time-passed">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill="#7c3aed" d="M11.39 8C13.542 6.635 15 4.012 15 1q0-.508-.054-1H1.055a9 9 0 0 0-.054 1c0 3.012 1.457 5.635 3.609 7c-2.152 1.365-3.609 3.988-3.609 7q0 .508.054 1h13.891q.054-.492.054-1c0-3.012-1.457-5.635-3.609-7zM2.5 15c0-2.921 1.253-5.397 3.5-6.214V7.214C3.753 6.397 2.5 3.92 2.5 1h11c0 2.921-1.253 5.397-3.5 6.214v1.572c2.247.817 3.5 3.294 3.5 6.214zm7.182-4.538C8.562 9.827 8.501 9.003 8.5 8.503V7.499c0-.5.059-1.327 1.184-1.963c.602-.349 1.122-.88 1.516-1.537H4.8c.395.657.916 1.188 1.518 1.538c1.12.635 1.181 1.459 1.182 1.959V8.5c0 .5-.059 1.327-1.184 1.963c-1.135.659-1.98 1.964-2.236 3.537h7.839c-.256-1.574-1.102-2.879-2.238-3.538z"/></svg>
                            <span class="minutos-pasados" style="display: none;">{{ order.created_at }}</span>
                        </div>
                        <div class="container-number-table-order">
                            <span class="order_code_view">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20"><path fill="#928aff" d="M10.32 2.013A4 4 0 0 0 6.162 7.13l-3.987 3.986a.6.6 0 0 0-.176.424v2.86a.6.6 0 0 0 .6.6h2.8a.6.6 0 0 0 .6-.6V13h1.9a.6.6 0 0 0 .6-.6v-1.693l.735-.735a5.5 5.5 0 0 1-.569-.846l-.99.991a.6.6 0 0 0-.176.424V12H5.6a.6.6 0 0 0-.6.6V14H3v-2.293l4.32-4.32l-.118-.303a3 3 0 0 1 1.96-3.965c.33-.423.72-.796 1.157-1.106M13.5 6.25a.75.75 0 1 0 0-1.5a.75.75 0 0 0 0 1.5M9 6.5a4.5 4.5 0 1 1 7 3.742v2.05l.783.784a.6.6 0 0 1 0 .848L15.707 15l1.068 1.067a.6.6 0 0 1-.05.893l-2.35 1.88a.6.6 0 0 1-.75 0l-2.4-1.92a.6.6 0 0 1-.225-.468v-6.21A4.5 4.5 0 0 1 9 6.5M13.5 3a3.5 3.5 0 0 0-1.75 6.532a.5.5 0 0 1 .25.433v6.295l2 1.6l1.751-1.401l-1.034-1.035a.6.6 0 0 1 0-.848l1.076-1.076l-.617-.617a.6.6 0 0 1-.176-.424V9.965a.5.5 0 0 1 .25-.433A3.5 3.5 0 0 0 13.5 3"/></svg>
                                {{ order.order_code }}
                            </span>
                            <strong>Mesa: </strong>
                            <span>{{ order.number_table }} &raquo; <span>{{ order.category_name }}</span></span>
                            <button class="button-open-table-edit-in-order" data-order-id="{{ order.id }}" data-order-table="{{ order.number_table }}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="none" stroke="#666666" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 21h16M5.666 13.187A2.28 2.28 0 0 0 5 14.797V18h3.223c.604 0 1.183-.24 1.61-.668l9.5-9.505a2.28 2.28 0 0 0 0-3.22l-.938-.94a2.277 2.277 0 0 0-3.222.001z"/></svg>
                            </button>
                        </div>
                        {% for food in order.data_orders %}
                            <div class="container-main-order-primary">
                                <h1>{{ food.category_name }}</h1>
                                <div class="container-main-food-row-all">
                                    <div class="container-main-food-row">
                                        <div class="block-main__body-icon">
                                            <img src="{{ food.image_food }}" alt="">                       
                                        </div>
                                        <div class="block-main__body-text">
                                            <button class="button-open-data-order-edit-in-order" data-id-data-order="{{ food.id }}">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="none" stroke="#666666" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 21h16M5.666 13.187A2.28 2.28 0 0 0 5 14.797V18h3.223c.604 0 1.183-.24 1.61-.668l9.5-9.505a2.28 2.28 0 0 0 0-3.22l-.938-.94a2.277 2.277 0 0 0-3.222.001z"/></svg>
                                            </button>
                                            <div class="block-main__body-text-parts">
                                                <strong>{{ food.food_name }}</strong>
                                            </div>
                                            <div class="block-main__body-text-parts d-flex gap-3">
                                                <table class="table-more-details-food">
                                                    <thead>
                                                        <th>Cant.</th>
                                                        <th>Tipo</th>
                                                        <th>Cost.</th>
                                                        <th>Total</th>
                                                    </thead>
                                                    <tbody>
                                                        <tr>
                                                            <td>{{ food.quantity }}</td>
                                                            <td>
                                                                {% if food.type_order|int == 1 %}
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="#ffffff" d="M2 7h20v3h-2l1 9h-2.5l-.56-5H6.06l-.56 5H3l1-9H2zm15.5 3h-11l-.21 2h11.42z"/></svg>
                                                                {% elif food.type_order|int == 2 %}
                                                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="23.56521739130434" viewBox="0 0 23 24"><path fill="#ffffff" d="M22.596 23.997H11.545a.325.325 0 0 1-.325-.326v-.016v.001l.65-12.947a.325.325 0 0 1 .324-.306h9.752c.173 0 .314.135.324.305v.001l.647 12.882q.01.037.01.081v.001a.324.324 0 0 1-.324.324h-.001zm-9.098-10.878c.002.468.309.863.732.998l.007.002c.341 1.651 1.514 2.873 2.908 2.873s2.565-1.223 2.904-2.868a1.056 1.056 0 1 0-.955-.185l.002.002c-.248 1.198-1.029 2.077-1.955 2.077s-1.703-.874-1.953-2.067a1.052 1.052 0 1 0-1.696-.834v.003zM.325 22.72a.325.325 0 0 1-.324-.343v.001L.905 4.383a.325.325 0 0 1 .324-.306h2.204C4.124 1.677 5.968.001 8.112.001s3.986 1.677 4.677 4.074h1.995c.172 0 .314.135.323.305v.001l.261 5.209h-3.174c-.608 0-1.104.477-1.135 1.077v.003l-.605 12.051zM10.948 5.678a1.442 1.442 0 0 0 .784 2.65a1.44 1.44 0 0 0 .518-2.786l-.01-.003C12.004 2.881 10.243.81 8.113.81S4.215 2.885 3.982 5.548a1.44 1.44 0 1 0 1.299.127l-.006-.003c.168-2.002 1.376-3.56 2.838-3.56s2.673 1.563 2.838 3.569zM6.559 4.073h3.1a1.9 1.9 0 0 0-1.541-1.15l-.009-.001c-.7.077-1.28.525-1.545 1.14zm12.799 9.018a.382.382 0 1 1 .762 0a.382.382 0 0 1-.761 0zm-5.224 0a.382.382 0 1 1 .382.382a.38.38 0 0 1-.378-.382zm-2.976-6.146a.567.567 0 1 1 1.135 0a.567.567 0 0 1-1.135 0m-7.228 0a.57.57 0 1 1 1.137 0a.57.57 0 0 1-1.136 0z"/></svg>
                                                                {% endif %}
                                                            </td>
                                                            <td>{{ food.price }}</td>
                                                            <td>{{ food.price|float * food.quantity|int }}</td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="block-main__body-obs">
                                        {% for obs in food.observations %}
                                            {% if obs %}
                                            <span>
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="#aeaeff" d="M18.5 16H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h12.5a2.5 2.5 0 0 1 0 5H9c-.55 0-1-.45-1-1s.45-1 1-1h9.5V9.5H9a2.5 2.5 0 0 0 0 5h10.5c2.21 0 4-1.79 4-4s-1.79-4-4-4H7c-3.04 0-5.5 2.46-5.5 5.5s2.46 5.5 5.5 5.5h11.5z"/></svg>
                                                {{ obs }}
                                            </span>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                                
                            </div>
                        {% endfor %}
                        <div class="block-main__buttons-action">
                            <button class="btn-del-more-data" data-identifier="{{ order.id }}">
                                Rechazar
                            </button>
                            <button class="btn-lock-more-data" data-identifier="{{ order.id }}" data-state="21">
                                Preparar
                            </button>
                            {% if order.order_with_product_code %}
                            <button class="btn-deliver-more-data" data-identifier="{{ order.id }}">
                                Entregar
                            </button>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            {% else %}
            
            {% endif %}
        </div>
        
    </section>
    <!-- MODALS ALL EVENTS -->
    <!-- Modal delete -->
    <div class="modal" id="delete-modal">
        <div class="modal-background"></div>
        <div class="modal-content">
            <div class="container-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path fill="currentColor" d="m20.37 8.91l-1 1.73l-12.13-7l1-1.73l3.04 1.75l1.36-.37l4.33 2.5l.37 1.37l3.03 1.75M6 19V7h5.07L18 11v8a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2Z"/></svg>
                <h5 class="">Rechazar?</h5>
            </div>
            <button type="button" id="btn-delete-order" class="">Rechazar</button>
        </div>
        <button class="modal-close is-large"></button>
    </div>
    <!-- order en proceso -->
    <div class="modal" id="confirm-modal">
        <div class="modal-background"></div>
        <div class="modal-content">
            
            <div class="container-title">
                <h5 class="">ConfirmaciÃ³n requerida</h5>
                <!-- <span>Â¿Confirma que el plato ya se entregÃ³ al cliente?</span> -->
            </div>
            <div class="container-btns-action-impr-conf">
                <button type="button" id="btn-lock-order" class="">Si, confirmo</button>
            </div>
        </div>
        <button class="modal-close is-large"></button>
    </div>
    <!-- orden con conexion al inventario -->
    <div class="modal" id="confirm-modal-with-connection">
        <div class="modal-background"></div>
        <div class="modal-content">
            
            <div class="container-title">
                <h5 class="">ConfirmaciÃ³n requerida</h5>
                <!-- <span>Â¿Confirma que el plato ya se entregÃ³ al cliente?</span> -->
            </div>
            <div class="container-btns-action-impr-conf">
                <button type="button" id="btn-lock-order-deliver" class="">Si, confirmo</button>
            </div>
        </div>
        <button class="modal-close is-large"></button>
    </div>
    <!-- update table in order -->
     <div class="modal" id="modal-edit-table-order">
        <div class="modal-background"></div>
        <div class="modal-content">
            <div class="container-title">
                <h2>Actualizar Mesa</h2>
            </div>
            <form action="">
                <div class="container-section-table-update">
                    <div class="container-template-select-div-ui">
                        <div class="container-template-select-div-ui__button-view" id="container-template-select-div-ui__button-view">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="#ffffff" d="M12 18.88a1 1 0 0 1-.29.83a1 1 0 0 1-1.41 0l-4-4a1 1 0 0 1-.3-.84V9.75L1.21 3.62a1 1 0 0 1 .17-1.4A1 1 0 0 1 2 2h14a1 1 0 0 1 .62.22a1 1 0 0 1 .17 1.4L12 9.75zM4 4l4 5.06v5.52l2 2V9.05L14 4m-1 12l5 5l5-5Z"/></svg>
                            <span id="text-value-select-ui">Categoria</span>
                        </div>
                        <div class="container-template-select-div-ui__container-options">
                            {% for category in category_table%}
                            <label>
                                <a href="#" data-category-id="" class="category-table-select">
                                    <span>{{ category.name  }}</span>
                                </a>
                            </label>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div class="container-inputs-table">
                    <div class="radio-inputs">
                        {% for table in tables %}
                        <label>
                            <input class="radio-input" value="{{ table.id }}" type="radio" name="new-table-update-order" data-number-table="{{ table.number_table }}">
                            <span class="radio-tile">
                                <span class="radio-icon">{{ table.number_table }}</span>
                            </span>
                        </label>
                        {% endfor %}
                    </div>
                </div> 
                <span>Â¿Â¡? La actualizaciÃ³n de la mesa refrescarÃ¡ todas las secciones con Ã³rdenes</span>
                <div class="container-buttons-actions">
                    <button type="button" onclick="closeModal(document.getElementById('modal-edit-table-order'))">Cerrar</button>
                    <button type="button" id="btn-submit-form-update-table">Actualizar</button>
                </div>
            </form>
        </div>
    </div>
    <!-- modal edit food data in order -->
    <div class="modal" id="modal-update-food-data-in-order">
        <div class="modal-background"></div>
        <div class="modal-content">
            <div class="container-title">
                <!-- <h2>Editar datos del plato</h2> -->
                <div class="container-info-food-title">
                    <img src="" id="image-food-view-update" alt="">
                    <span id="name-food-view-update"></span>
                </div>
            </div>
            <form action="">
                <div class="container-inputs-form">
                    <div class="container-main-template-input-simple">
                        <label for="">
                            <span>Cantidad *</span>
                            <input type="text" value="" name="" id="quantity-food-view-update" class="input-simple-main-template" required>
                        </label>
                    </div>
                    <div class="container-main-template-input-simple">
                        <label for="">
                            <span>Tipo *</span>
                            <select name="" id="type-food-view-update" class="input-simple-main-template" required>
                                <option value="1">Para mesa</option>
                                <option value="2">Para llevar</option>
                            </select>
                        </label>
                    </div>
                </div>
                <div class="container-sections-observations">
                    <h3>Observaciones</h3>
                    <div class="container-observations">

                        <!-- <label for="">
                            <input type="checkbox" name="" id="" required>
                            <span>Con ensalada</span>
                        </label>
                         -->
                    </div>
                </div>
                <div class="container-buttons-actions-text">
                    <!-- <span>Â¿Â¡? Al actualizar refrescarÃ¡ todas las secciones con Ã³rdenes</span> -->
                    <div class="container-buttons-actions">
                        <button type="button" onclick="closeModal(document.getElementById('modal-update-food-data-in-order'))">Cerrar</button>
                        <button type="button" id="button-update-data-order-main">Actualizar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!-- FIN MODALS -->
{% endblock %}

{% block main_link_js %}
    <script>
        const calTCRT = (span_min) =>{
            const fechaCreacion = new Date(span_min.textContent); // AutomÃ¡ticamente reconoce la zona horaria
            const ahora = new Date(); // Fecha actual en la zona horaria local
            // Calcular la diferencia en minutos
            const diferenciaMilisegundos = ahora - fechaCreacion;
            let minutosPasados = Math.floor(diferenciaMilisegundos / 60000);
            let segundos = Math.floor((diferenciaMilisegundos % 60000) / 1000);
            function actualizarTiempo() {
                segundos++;
                if (segundos === 60) {
                    segundos = 0;
                    minutosPasados++;
                }
                const tiempoFormateado = `${String(minutosPasados).padStart(2, '0')}:${String(segundos).padStart(2, '0')}`;
                span_min.textContent = tiempoFormateado + " minutos";
                if (span_min.getAttribute("style")){
                    span_min.removeAttribute("style");
                }
            }
            setInterval(actualizarTiempo, 1000);
        }
        const checked_new_order_sound = document.getElementById("checked-new-order-sound");
        const container_all_order = document.getElementById("container-table-div-scroll-view-perfect");
        

        const insert_new_order = (data_order_process) =>{
            let data_order_json = data_order_process;
            let temp_4 = "";
            let temp_3 = "";
            let temp_2 = "";
            let temp_1 = "";
            data_order_json.data_orders.forEach(el=>{
                let number_table_order = 0;
                temp_1 = "";
                // aqui
                number_table_order = data_order_json.number_table;
                let category_order_icon = "";
                if (parseInt(el.type_order) === 1){
                    category_order_icon = '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="#ffffff" d="M2 7h20v3h-2l1 9h-2.5l-.56-5H6.06l-.56 5H3l1-9H2zm15.5 3h-11l-.21 2h11.42z"/></svg>';
                }else if (parseInt(el.type_order) === 2){
                    category_order_icon = '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="23.56521739130434" viewBox="0 0 23 24"><path fill="#ffffff" d="M22.596 23.997H11.545a.325.325 0 0 1-.325-.326v-.016v.001l.65-12.947a.325.325 0 0 1 .324-.306h9.752c.173 0 .314.135.324.305v.001l.647 12.882q.01.037.01.081v.001a.324.324 0 0 1-.324.324h-.001zm-9.098-10.878c.002.468.309.863.732.998l.007.002c.341 1.651 1.514 2.873 2.908 2.873s2.565-1.223 2.904-2.868a1.056 1.056 0 1 0-.955-.185l.002.002c-.248 1.198-1.029 2.077-1.955 2.077s-1.703-.874-1.953-2.067a1.052 1.052 0 1 0-1.696-.834v.003zM.325 22.72a.325.325 0 0 1-.324-.343v.001L.905 4.383a.325.325 0 0 1 .324-.306h2.204C4.124 1.677 5.968.001 8.112.001s3.986 1.677 4.677 4.074h1.995c.172 0 .314.135.323.305v.001l.261 5.209h-3.174c-.608 0-1.104.477-1.135 1.077v.003l-.605 12.051zM10.948 5.678a1.442 1.442 0 0 0 .784 2.65a1.44 1.44 0 0 0 .518-2.786l-.01-.003C12.004 2.881 10.243.81 8.113.81S4.215 2.885 3.982 5.548a1.44 1.44 0 1 0 1.299.127l-.006-.003c.168-2.002 1.376-3.56 2.838-3.56s2.673 1.563 2.838 3.569zM6.559 4.073h3.1a1.9 1.9 0 0 0-1.541-1.15l-.009-.001c-.7.077-1.28.525-1.545 1.14zm12.799 9.018a.382.382 0 1 1 .762 0a.382.382 0 0 1-.761 0zm-5.224 0a.382.382 0 1 1 .382.382a.38.38 0 0 1-.378-.382zm-2.976-6.146a.567.567 0 1 1 1.135 0a.567.567 0 0 1-1.135 0m-7.228 0a.57.57 0 1 1 1.137 0a.57.57 0 0 1-1.136 0z"/></svg>';
                }else if (parseInt(el.type_order) === 3){
                    category_order_icon = '<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 128 128"><path fill="#4D453C" d="M105.86 123.68c11.59-1.34 18.02-12.08 15.83-22.61c-1.71-8.2-8.76-16.4-21.2-14.98c-13.19 1.5-17.31 14.13-15.62 22.61c1.98 9.91 10.19 16.23 20.99 14.98"/><path fill="#FFF" d="M101.33 95.28c-5.3 1.04-9.21 5.57-8.2 11.59c1.06 6.33 6.62 8.96 12.14 7.95c5.87-1.08 8.77-5.87 7.83-11.7c-.84-5.26-6.25-8.92-11.77-7.84"/><path fill="#B0B0B0" d="M104.31 113.18c5.03-.57 7.83-5.14 6.88-9.63c-.74-3.49-3.81-6.98-9.21-6.38c-5.73.64-7.52 6.02-6.78 9.63c.85 4.23 4.42 6.92 9.11 6.38"/><path fill="#4D453C" d="M24.74 124.19c11.33-1.3 17.61-11.7 15.47-21.89c-1.67-7.94-8.57-15.87-20.72-14.5C6.6 89.25 2.56 101.48 4.22 109.69c1.94 9.6 9.97 15.71 20.52 14.5"/><path fill="#FFF" d="M20.45 95.75c-5.53 1.08-9.6 5.8-8.55 12.07c1.11 6.6 6.69 9.46 12.45 8.4c6.11-1.12 9.16-6.15 8.18-12.22c-.88-5.48-6.34-9.37-12.08-8.25"/><path fill="#B0B0B0" d="M23.35 113.76c4.8-.54 7.46-4.87 6.55-9.12c-.71-3.31-3.63-6.61-8.78-6.04c-5.46.6-7.17 5.7-6.47 9.12c.83 3.99 4.23 6.54 8.7 6.04"/><path fill="#2F2F2F" d="M29.08 87.8s-8.81 14.22-9.88 16.49c-1.07 2.27-1.13 4.48 1.07 5.76c2.33 1.36 4.49-.36 5.77-2.61c.98-1.72 12.29-18.86 12.29-18.86z"/><path fill="#FC8F02" d="M26.68 76.73s-1.06 0-2.27.18c-1.21.19-1.55.29-1.55.29l1.68 10.42l8.57 4.94s4.11 2.5 7.51 5.74c.86.82 2.18.22 2.09-.15s-8.94-20.12-8.94-20.12z"/><path fill="#FFA726" d="M8.71 90.41c.65.98 5.63-.95 13.66-.63c5.88.24 10.87 2.89 10.87 2.89s-3.33-6.88-5.53-10.05c-2.75-3.97-4.83-5.42-4.83-5.42s-4.1.59-8.99 4.55c-3.63 2.94-5.95 7.5-5.18 8.66"/><path fill="#FAD91A" d="M13.75 85.33c.75 1.01 3.27-1.2 5.58-2.12s4.14-.88 4.67-1.78c.53-.91.58-2.69-1.78-2.65c-3.71.09-9.57 5.06-8.47 6.55"/><path fill="#5E636F" d="M46.67 37.82c-.12.41-3.02 6.98-3.02 6.98l4.04 7.37l5.32-4.52l1.91-5.42z"/><path fill="#FC8F0B" d="M50.62 41.3s3.61 2.09 4.3 1.69s2.64-5.87 3.49-6.05c1.63-.35 4.09-1.09 4.65-4.07c.87-4.59-2.5-4.54-2.5-4.54l-9.89 2.62z"/><path fill="#FCB90A" d="M51.2 21.36c-1.1-.47-13.49.23-15.29.64s-1.8 3.08-1.8 3.08l2.91 10.93s1.05.47 2.68.47c1.16 0 2.04.35 2.73.7c.7.35 8.2 4.13 8.2 4.13l5.47-9.83l6.4-1.98s-.58-1.28-2.85-1.92c-2.27-.64-4.19-1.45-5.35-2.91c-1.18-1.45-1.99-2.85-3.1-3.31"/><path fill="#FED519" d="M48.47 23.68c.25.96-1.28 2.33-3.2 3.49c-1.92 1.16-4.54 2.27-5.35.7c-.81-1.57-1.89-4.34-.29-4.71c1.74-.41 8.43-1.05 8.84.52"/><path fill="#DEDFE2" d="M34.63 22.93c-1.05.12-2.97 2.82-1.74 7.56c1.22 4.71 3.53 6.06 5.12 5.58c1.92-.58 1.45-3.72.47-7.68c-.78-3.05-2.69-5.59-3.85-5.46"/><path fill="#464C4F" d="M73.13 28.98s-13.72.06-15.06.12c-1.34.06-2.62 1.4-2.38 2.97c.23 1.57 1.22 2.5 2.62 2.5c1.4 0 14.25-.12 14.25-.12s1.51-.7 1.51-3.14c-.01-2.04-.94-2.33-.94-2.33m-16.29-8.61l-.12 6.34s-.29 1.93-1.74 1.98c-1.98.06-2.04-2.09-2.04-2.09s.06-9.82.06-10.35c0-1.45 1.16-4.07 2.91-6.11s3.26-3.26 4.65-2.62c1.4.64 1.63 3.84 1.57 6.8c-.06 3.02-.3 6.6-1.51 7.04c-1.62.58-3.78-.99-3.78-.99"/><path fill="#FF281D" d="M111.7 68.42s5.35-1.35 6.23-1.09c.88.26 1.78 1.97 2.34 4.26c.52 2.13 1.05 4.82.78 5.14c-.52.62-2.65.99-2.65.99s-6.49-5.55-6.59-5.87s-.11-3.43-.11-3.43"/><path fill="#FC8F0B" d="M45.79 43.03s5.71 2.68 6.51 3.12c.8.45 1.43 1.16.8 2.68c-.62 1.52-4.55 13.74-5.17 17.84s-.27 8.65-.27 8.65L35.53 78l-2.14-4.91z"/><path fill="#5F6364" d="m36.51 75.05l11.15.27s.26 3.62 2.05 7.94c1.32 3.17 3.89 8.26 5.89 9.54c.83.54 3.66 1.34 6.6 1.34c2.59 0 4.63-.74 6.07-1.63c1.64-1.02 2.4-2.03 2.4-2.03L82 88.87l-1.25 15.07l-27.65.09l-14.9-14.9z"/><path fill="#FE8D00" d="M75.88 65.88c-1.7.28-5.66 3.59-5.66 3.59l.74 3.35l31.33 7.26l20.44 3.24s-3.23-6.88-7.5-12.04c-3.52-4.26-6.02-5.85-6.02-5.85z"/><path fill="#FDB700" d="M43.74 41.99s2.94 1.41 3.67 1.83c1.1.64.25 3.43-.69 5.02c-.94 1.59-4.94 7.34-7.06 13.84c-1.67 5.11-1.29 13.04-.73 16.12c.5 2.76 5.86 13.14 8.31 16.9c2.7 4.15 5.21 5.13 7.46 5.58c3.64.73 15.95.19 19.78-.56c3.83-.75 5.22-3.08 2.24-5.78c-2.99-2.71-6.03-4.45-6.03-4.45s2.59-3.59 2.2-7.03c-.28-2.52-1.94-10.64-1.94-10.64l16.58-.18l14.18-.65l12.35 3s4.04 1.56 7.48 6.33c2.62 3.63 3.87 7.37 4.15 8.49c.28 1.12 1.69 5.19-.36 5.66c-2.05.47-31.12 2.9-33.55 3.27c-2.43.37-5.59-.09-6.77 3.01c-1.21 3.2-.84 6.06-6.72 6.25c-5.88.19-24.42 2.21-29.31-1.36c-4.07-2.96-9.5-8.63-15-18.05S26 76.75 26 76.75l.52-5.6l8.86-19.59l7.65-8.86z"/><path fill="#FED519" d="M41.64 41.08c-.56-.19-7.36 6.61-11.21 14.39c-5.13 10.36-4.45 21.3-4.45 21.3s2.67-1.71 3.7-3.76c1.03-2.05 3.83-10.82 3.83-10.82s2.61-5.69 6.72-12.13c2.03-3.19 5.53-6.89 5.02-7.3c-.55-.45-3.61-1.68-3.61-1.68M82.67 95.3c1.06-.6-3.24-9.47 1.59-15.58c4.2-5.32 10.82-5.97 17.73-5.69c5.71.23 13.62 1.77 13.62 1.77s-10.73-8.86-27.62-5.69C75.13 72.53 75.02 82.7 76.42 87.09c1.5 4.68 5.6 8.58 6.25 8.21"/><path fill="#464C4F" d="M67.37 67.69c.09 1.21.21 2.17 2.43 2.15c2.21-.02 11.1-.37 21.64-.65c10.54-.28 14.18-.56 16.05-1.21c1.87-.65 2.61-1.49 2.8-3.55c.19-2.05 0-6.62-.47-8.21c-.47-1.59-1.49-2.05-3.92-2.15c-2.25-.09-9.05-.09-10.08-.09c-2.15 0-9.42 4.85-10.45 5.04s-4.57.37-8.68.37c-3.36 0-6.34-.19-7.09-.28s-2.43.45-2.43 2.33c.02 2.33.13 5.27.2 6.25"/><path fill="#FFF" d="M34.15 62.19c-1.42-.69-4.08 1.1-5.5 6.05c-1.33 4.63.41 7.02 1.65 6.79c1.22-.23 1.19-4.27 2.39-6.97c1.19-2.7 2.74-5.25 1.46-5.87"/></svg>';
                }
                el.observations.forEach(obs=>{
                    if (obs.length > 0){
                        temp_2 = temp_2 +
                                        '<span>'+
                                        '    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="#aeaeff" d="M18.5 16H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h12.5a2.5 2.5 0 0 1 0 5H9c-.55 0-1-.45-1-1s.45-1 1-1h9.5V9.5H9a2.5 2.5 0 0 0 0 5h10.5c2.21 0 4-1.79 4-4s-1.79-4-4-4H7c-3.04 0-5.5 2.46-5.5 5.5s2.46 5.5 5.5 5.5h11.5z"/></svg>'+
                                        obs +
                                        '</span>'; 
                    }
                })
                temp_1 = temp_1 + '<div class="container-main-food-row-all">'+
                '    <div class="container-main-food-row">'+
                '        <div class="block-main__body-icon">'+
                '            <img src="'+ el.image_food +'" alt="">'+
                '        </div>'+
                '        <div class="block-main__body-text">'+
                '            <div class="block-main__body-text-parts">'+
                '                <strong>'+ el.food_name +'</strong>'+
                '            </div>'+
                '            <div class="block-main__body-text-parts d-flex gap-3">'+
                '                <table class="table-more-details-food">'+
                '                    <thead>'+
                '                        <th>Cant.</th>'+
                '                        <th>Tipo</th>'+
                '                        <th>Cost.</th>'+
                '                        <th>Total</th>'+
                '                    </thead>'+
                '                    <tbody>'+
                '                        <tr>'+
                '                            <td>'+ el.quantity +'</td>'+
                '                            <td>'+
                category_order_icon +
                '                            </td>'+
                '                            <td>'+ el.price +'</td>'+
                '                            <td>'+ String(parseFloat(el.price)*parseInt(el.quantity)) +'</td>'+
                '                        </tr>'+
                '                    </tbody>'+
                '                </table>'+
                '            </div>'+
                '        </div>'+
                '    </div>'+
                '    <div class="block-main__body-obs">'+
                temp_2 +
                '    </div>'+
                '</div>';
                // FIN
                temp_3 = temp_3 +   '<div class="container-main-order-primary">'+
                                    '    <h1>'+ el.category_name +'</h1>'+
                                        temp_1+
                                    '</div>';
                temp_4 ='<div class="container-all-of-folder-block__block-main" id="container-'+ data_order_json.id +'">'+
                        '    <div class="container-profile-user-context">'+
                        '        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="#8750e8" d="M12 2a5 5 0 1 0 5 5a5 5 0 0 0-5-5m0 8a3 3 0 1 1 3-3a3 3 0 0 1-3 3m9 11v-1a7 7 0 0 0-7-7h-4a7 7 0 0 0-7 7v1h2v-1a5 5 0 0 1 5-5h4a5 5 0 0 1 5 5v1z"/></svg>'+
                        '        <span>'+ data_order_json.user_context_name +'</span>'+
                        '    </div>'+
                        '    <div class="container-time-passed">'+
                        '       <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill="#7c3aed" d="M11.39 8C13.542 6.635 15 4.012 15 1q0-.508-.054-1H1.055a9 9 0 0 0-.054 1c0 3.012 1.457 5.635 3.609 7c-2.152 1.365-3.609 3.988-3.609 7q0 .508.054 1h13.891q.054-.492.054-1c0-3.012-1.457-5.635-3.609-7zM2.5 15c0-2.921 1.253-5.397 3.5-6.214V7.214C3.753 6.397 2.5 3.92 2.5 1h11c0 2.921-1.253 5.397-3.5 6.214v1.572c2.247.817 3.5 3.294 3.5 6.214zm7.182-4.538C8.562 9.827 8.501 9.003 8.5 8.503V7.499c0-.5.059-1.327 1.184-1.963c.602-.349 1.122-.88 1.516-1.537H4.8c.395.657.916 1.188 1.518 1.538c1.12.635 1.181 1.459 1.182 1.959V8.5c0 .5-.059 1.327-1.184 1.963c-1.135.659-1.98 1.964-2.236 3.537h7.839c-.256-1.574-1.102-2.879-2.238-3.538z"/></svg>'+
                        '       <span class="minutos-pasados" style="display: none;">' + data_order_json.created_at + '</span>'+
                        '    </div>'+
                        '    <div class="container-number-table-order">'+
                        '        <span class="order_code_view">'+
                        '            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20"><path fill="#928aff" d="M10.32 2.013A4 4 0 0 0 6.162 7.13l-3.987 3.986a.6.6 0 0 0-.176.424v2.86a.6.6 0 0 0 .6.6h2.8a.6.6 0 0 0 .6-.6V13h1.9a.6.6 0 0 0 .6-.6v-1.693l.735-.735a5.5 5.5 0 0 1-.569-.846l-.99.991a.6.6 0 0 0-.176.424V12H5.6a.6.6 0 0 0-.6.6V14H3v-2.293l4.32-4.32l-.118-.303a3 3 0 0 1 1.96-3.965c.33-.423.72-.796 1.157-1.106M13.5 6.25a.75.75 0 1 0 0-1.5a.75.75 0 0 0 0 1.5M9 6.5a4.5 4.5 0 1 1 7 3.742v2.05l.783.784a.6.6 0 0 1 0 .848L15.707 15l1.068 1.067a.6.6 0 0 1-.05.893l-2.35 1.88a.6.6 0 0 1-.75 0l-2.4-1.92a.6.6 0 0 1-.225-.468v-6.21A4.5 4.5 0 0 1 9 6.5M13.5 3a3.5 3.5 0 0 0-1.75 6.532a.5.5 0 0 1 .25.433v6.295l2 1.6l1.751-1.401l-1.034-1.035a.6.6 0 0 1 0-.848l1.076-1.076l-.617-.617a.6.6 0 0 1-.176-.424V9.965a.5.5 0 0 1 .25-.433A3.5 3.5 0 0 0 13.5 3"/></svg>'+
                                    + data_order_json.order_code +
                        '        </span>'+
                        '        <strong>Mesa: </strong>'+
                        '        <span>'+ number_table_order +' &raquo; <span>'+ data_order_json.category_table +'</span></span>'+
                        '    </div>'+
                        temp_3+
                        '    <div class="block-main__buttons-action">'+
                        '        <button class="btn-del-more-data" data-identifier="'+ data_order_json.id +'">'+
                        '            Rechazar'+
                        '        </button>'+
                        '        <button class="btn-lock-more-data" data-identifier="'+ data_order_json.id +'" data-state="21">'+
                        '            Aceptar'+
                        '        </button>'+
                        '    </div>'+
                        '</div>';
            })    



            container_all_order.insertAdjacentHTML("beforeend", temp_4);
            const mpsds = container_all_order.querySelectorAll(".minutos-pasados");
            calTCRT(mpsds[mpsds.length - 1]);
            if (checked_new_order_sound.checked){
                const audioMessage = new Audio("/static/audios/livechat-129007.mp3");
                audioMessage.play();
            }
        };
    </script> 
    
    <script src="{{ url_for('static', filename='js/libraries/socket.io.js') }}"></script>
    <script type="text/javascript" charset="utf-8">
        var socket = io({transports: ['websocket'],});
        socket.on('connect', function() {
            socket.emit('join_group_res_personalized', {room_app: 'main_group'});
        });
        socket.on("message_order_state_1", async(data)=>{
            const i = JSON.parse(data);
            await fetch("/honey/ordenes/get_data_json?id="+String(i.id)).then(res => res.json()).then(data_=>{
                insert_new_order(data_);
            });
        });
        socket.on("message_order_state_6", (data)=>{
            const i = JSON.parse(data);
            const block = document.getElementById("container-"+String(i.id));
            if (checked_new_order_sound.checked){
                const audioMessage = new Audio("/static/audios/windows-error-sound-effect-35894.mp3");
                audioMessage.play();
            }
            block.remove();
        });
        socket.on("message_order_state_21", (data)=>{
            const i = JSON.parse(data);
            const block = document.getElementById("container-"+String(i.id));
            block.remove();
        });
        // seccion de entrega de producto con relacion al inventario
        let idel = null;
        const btn_deliver_more_data = document.querySelectorAll(".btn-deliver-more-data");
        btn_deliver_more_data.forEach(btn =>{
            btn.addEventListener("click", ()=>{
                idel = btn.dataset.identifier;
                openModal(document.getElementById("confirm-modal-with-connection"));
            });
        });
        const btn_lock_order_deliver = document.getElementById("btn-lock-order-deliver");
        btn_lock_order_deliver.addEventListener("click", async()=>{            
            if (idel){
                btn_lock_order_deliver.textContent = "Confirmando...";
                btn_lock_order_deliver.disabled = true;
                await fetch("/honey/update_order_state?row="+String(idel)+"&state="+String(4)).then(res => res.text()).then(data=>{
                    btn_lock_order_deliver.textContent = "Confirmar";
                    btn_lock_order_deliver.removeAttribute("disabled");
                    document.getElementById("container-"+String(idel)).remove();
                    closeModal(document.getElementById("confirm-modal-with-connection"));
                });
            };
        });

    </script>
    <script src="{{ url_for('static', filename='js/crud_js_control.js') }}"></script>
    <script>
        const crud = new CrudControl();
        crud.order_complet();
        crud.order_delete();
        crud.order_update_table();
        crud.order_update_food();
        crud.timeCalcOrder();
    </script>
    
{% endblock %}