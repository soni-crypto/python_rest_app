<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/libraries/bulma.min.css') }}">
    <link type="text/css" rel="stylesheet" href="{{ url_for('static', filename='styles/page_client/checkout_app.css') }}"/>
    <title>Fin</title>
</head>
<body>
    <div class="section-container-all">
        <div class="container-block-main box">
            <form action="" method="post" id="form-process-in-page-app">
                <div class="container-inputs-data-client">
                    <div class="title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24"><path fill="#333333" d="M12 4a3.5 3.5 0 1 0 0 7a3.5 3.5 0 0 0 0-7M6.5 7.5a5.5 5.5 0 1 1 11 0a5.5 5.5 0 0 1-11 0M3 19a5 5 0 0 1 5-5h8a5 5 0 0 1 5 5v3H3zm5-3a3 3 0 0 0-3 3v1h14v-1a3 3 0 0 0-3-3z"/></svg>
                        <h3>Datos</h3>
                    </div>
                    <div class="container-inputs">
                        <label for="">
                            <span>Nombre *</span>
                            <input type="text" id="name_input" class="input" placeholder="Nombre" required>
                        </label>
                        <label for="">
                            <span>Apellido *</span>
                            <input type="text" id="surname_input" class="input" placeholder="Apellido" required>
                        </label>
                        <label for="" class="no-order">
                            <span>Email *</span>
                            <input type="email" id="email_input" class="input" placeholder="Email" required name="email_input">
                        </label>
                        <label for="" class="no-order">
                            <span>WhatsApp *</span>
                            <input type="tel" id="telephone_input" class="input" placeholder="WhatsApp" required minlength="9" name="telephone_input">
                        </label>
                        <!-- <label for="open-account" class="no-order">
                            <input type="checkbox" name="" id="open-account">
                            <span class="tag">Abrir mi cuenta</span>
                        </label>
                        <label for="password" class="no-order">
                            <span>Contraseña</span>
                            <input type="password" class="input" name="" id="password">
                        </label> -->
                    </div>
                </div>
                <div class="container-details-data">
                    <div class="title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 20 20"><g fill="#333333" fill-rule="evenodd" clip-rule="evenodd"><path d="M0 7a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm18 0H2v11h16z"/><path d="M5.75 9.5a.75.75 0 0 1 .75-.75h7a.75.75 0 0 1 0 1.5h-7a.75.75 0 0 1-.75-.75m-1 3a.75.75 0 0 1 .75-.75h9a.75.75 0 0 1 0 1.5h-9a.75.75 0 0 1-.75-.75m1 3a.75.75 0 0 1 .75-.75h7a.75.75 0 0 1 0 1.5h-7a.75.75 0 0 1-.75-.75m5.664-12.672a2 2 0 0 0-2.828 0l-3.879 3.88a1 1 0 1 1-1.414-1.415l3.879-3.879a4 4 0 0 1 5.656 0l3.88 3.879a1 1 0 0 1-1.415 1.414z"/></g></svg>
                        <h3>Detalles</h3>
                    </div>
                    <div class="container-info">
                        <div class="row-datils row-datils-title">
                            <strong>Producto</strong>
                            <strong>Total</strong>
                        </div>
                        <div class="container-data-checkout box">
                            <!-- <div class="row-datils">
                                <span>Hamburguesa</span>    
                                <span>€ 12.00 <span class="tag is-link is-light">2</span></span>
                            </div> -->
                        </div>


                        <div class="row-datils row-show-2-3">
                            <strong>Delivery: </strong>
                            <span class="delivery-value-span"></span>
                        </div>
                        <div class="row-datils">
                            <strong>Total:</strong>
                            <strong>{{ data_admin_session.currency }} <span id="total-cost-span">0.00</span></strong>
                        </div>
                    </div>
                    <div class="container-more-info">
                        <div class="block-row">
                            <Strong>Tipo:</Strong>
                            <span class="category-sel-span"></span>
                        </div>
                        <div class="block-row row-show-1">
                            <Strong>Mesa:</Strong>
                            <span class="span-table">909</span>
                        </div>
                        <div class="block-row row-show-2-3">
                            <strong>Fecha:</strong>
                            <span class="span-value-date"></span>
                        </div>
                        <div class="block-row row-show-2-3">
                            <strong>Hora:</strong>
                            <span class="span-value-hour"></span>
                        </div>
                        <div class="block-row">
                            <!-- <Strong>Comentario:</Strong> -->
                            <span class="span-observation tag is-info"></span>
                        </div>
                    </div>
                    <div class="container-checkbox">
                        <label for="terms" class="label-terms">
                            <input type="checkbox" name="" id="terms" required>
                            <span>Acepte los <a href="#">términos y condiciones</a></span>
                        </label>
                    </div>
                    <div class="container-buttons-nav-return-continue">
                        <button class="button is-primary is-rounded" id="button_return" data-dir="" type="button">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path fill="#ffffff" d="m3.55 12l7.35 7.35q.375.375.363.875t-.388.875t-.875.375t-.875-.375l-7.7-7.675q-.3-.3-.45-.675T.825 12t.15-.75t.45-.675l7.7-7.7q.375-.375.888-.363t.887.388t.375.875t-.375.875z"/></svg>
                            Volver
                        </button>
                        <button class="button is-link is-rounded" id="btn-save" type="submit">
                            Enviar
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 14 14"><path fill="none" stroke="#ffffff" stroke-linecap="round" stroke-linejoin="round" d="m5.812 11l2.178 2.168a1.1 1.1 0 0 0 1.05.3a1.12 1.12 0 0 0 .809-.74l3.576-10.72A1.118 1.118 0 0 0 11.987.57L1.267 4.147a1.12 1.12 0 0 0-.74.859a1.1 1.1 0 0 0 .3 1l2.737 2.737l-.09 3.466zM13.106.79L3.564 8.742"/></svg>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <script>
        const templateRow = (money, name, price, quantity) => {
            let a = '<div class="row-datils">'+
                    '    <span class="name-product-span">'+ name +'</span>'+
                    '    <span>'+ money +' '+ price +' <span class="tag is-link is-light">'+ quantity +'</span></span>'+
                    '</div>';
            return a;
        };
        const form_app = document.getElementById("form-process-in-page-app");
        const button_return = document.getElementById("button_return");
        const container_data = document.querySelector(".container-data-checkout");
        const category_span = document.querySelector(".category-sel-span");
        const row_show_2_3 = document.querySelectorAll(".row-show-2-3");
        const row_show_1 = document.querySelectorAll(".row-show-1");
        const row_delivery = document.querySelector(".delivery-value-span");
        const row_date = document.querySelector(".span-value-date");
        const row_hour = document.querySelector(".span-value-hour");
        const row_observation = document.querySelector(".span-observation");
        const row_table = document.querySelector(".span-table");
        let data = localStorage.getItem("jdapp");
        if (data){
            data = JSON.parse(data);
            let total_cost_span = document.getElementById("total-cost-span");
            let cont_tc = 0.00;
            row_table.textContent = data.data.table_name;
            row_observation.textContent = data.data.message;
            button_return.addEventListener("click", ()=>{
                location.href = button_return.dataset.dir;
            })
            data.products.forEach((a)=>{
                const t = templateRow(data.data.money, a.name, (a.price * a.quantity).toFixed(2), a.quantity)
                container_data.insertAdjacentHTML("afterbegin", t);
                cont_tc += (a.price * a.quantity);
            });
            if (data.data.category === 1){
                button_return.dataset.dir = "table";
                category_span.textContent = "Órden";
                row_show_2_3.forEach(r => {
                    r.style.display = "none";
                });
                document.querySelectorAll(".no-order").forEach(e=>{
                    e.remove();
                })
            }else if(data.data.category === 2){
                button_return.dataset.dir = "calendar";
                category_span.textContent = "Reserva";
                row_date.textContent = data.data.date;
                row_hour.textContent = data.data.hour;
                row_show_2_3[0].style.display = "none";
                row_show_1.forEach(r => {
                    r.style.display = "none";
                });
            }else if(data.data.category === 3){
                button_return.dataset.dir = "delivery";
                row_show_1.forEach(r => {
                    r.style.display = "none";
                });
                cont_tc += data.data.price_delivery;
                category_span.textContent = "Delivery";
                row_date.textContent = data.data.date;
                row_hour.textContent = data.data.hour;
                row_delivery.textContent = data.data.money +" "+ data.data.price_delivery;

            }else{
                category_span.textContent = "Error";

            }
            
            total_cost_span.textContent = cont_tc.toFixed(2);   
        }
        form_app.addEventListener("submit", async(e)=>{
            e.preventDefault();
            const name_input = document.getElementById("name_input");
            const surname_input = document.getElementById("surname_input");
            const email_input = document.getElementById("email_input");
            const telephone_input = document.getElementById("telephone_input");
            console.log(email_input)
            let jdapp = localStorage.getItem("jdapp");
            jdapp = JSON.parse(jdapp);
            jdapp.data.user_name = name_input ? name_input.value : "";
            jdapp.data.user_surnames = surname_input ? surname_input.value : "";
            jdapp.data.user_email = email_input ? email_input.value : "";
            jdapp.data.user_telephone = telephone_input ? telephone_input.value : "";
            
            await fetch("save_data", {
                method:"POST",
                headers : {
                    "Content-Type" : "application/json",
                },
                body : JSON.stringify(jdapp),
            }).then(res => res.text()).then(data =>{
                localStorage.removeItem("jdapp");
                location.href="thanks";
            });
            
        });
    </script>
</body>
</html>